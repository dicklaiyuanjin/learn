# golang版本protobuf的自定义代码生成器插件

## 先参考官方的写法
* [ 先参考官方怎么自己定义内置插件gRPC的代码生成器](https://github.com/golang/protobuf/tree/master/protoc-gen-go) 
	* 可以发现，需要定义的link_grpc.go文件，里面将导入插件grpc
	* main.go文件中，导入必要的东西，执行必要的操作，特别注意导入了generator包的

* [接着看generator包的主要代码](https://github.com/golang/protobuf/blob/master/protoc-gen-go/generator/generator.go) 
	* 注意到接口Plugin，自定义插件就是通过这个接口实现的
```golang
type Plugin interface {
	// Name identifies the plugin.
	Name() string
	// Init is called once after data structures are built but before
	// code generation begins.
	Init(g *Generator)
	// Generate produces the code generated by the plugin for this file,
	// except for the imports, by calling the generator's methods P, In, and Out.
	Generate(file *FileDescriptor)
	// GenerateImports produces the import declarations for this file.
	// It is called after Generate.
	GenerateImports(file *FileDescriptor)
}
```

* [ 再看插件grpc的写法](https://github.com/golang/protobuf/blob/master/protoc-gen-go/grpc/grpc.go) 
	* 实际上就是实现了Plugin插件

## 再自定义代码生成器的插件
* 先创建自定义的生成器目录protoc-gen-go-netrpc
```shell
mkdir protoc-gen-go-netrpc
```
* 在这个新创建的目录下再创建一个gnetrpc的目录用来放自定义插件gnetrpc的代码
```shell
mkdir gnetrpc
```
* 在gnetrpc目录下创建自定义插件源代码，实现Plugin接口(要注意，除了导入generator包，大多数时候还需要导入descriptor包)
* 接着模仿官方写法，完成文件link_gnetrpc.go和main.go
* 然后在目录protoc-gen-go-netrpc下进行go build操作生成可执行文件protoc-gen-go-netrpc
* 将可执行文件放在系统目录（环境变量）下，我的做法是将其放入$GOPATH/bin中，这个目录我加入了$PATH中了
* 然后执行protoc编译相关的protobuf文件（我这里的例子是hello.proto）
```shell
protoc --go-netrpc_out=plugins=netrpc:. hello.proto
```
* 至此，就生成了相应的操作protobuf的go代码文件hello.pb.go